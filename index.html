<!DOCTYPE html>
<html>
<head>
    <title>Home</title>
    <script type="module" src="js/transactAccountList.js"></script>
    <style>
        input {
            margin: 5px;
            display: block;
        }
        button {
            margin: 5px;
            display: block;
        }
        section {
            margin: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: antiquewhite;
            border-radius: 15px;
        }
    </style>
</head>
<body onload="listAccounts()">
    <center>
        <h1>Transact</h1>
        <section>
            <transact-account-list></transact-account-list>
        </section>

        <section>
            <p>Transfer Money</p>
            <input type="text" id="sourceNumber" placeholder="Source Account Number">
            <input type="text" id="targetNumber" placeholder="Target Account Number">
            <input type="text" id="amount" placeholder="Amount">
            <button onclick="transferMoney()">Transfer</button>
        </section>

        <section>
            <p>Deposit</p>
            <input type="text" id="depositAccount" placeholder="Account Number">
            <input type="text" id="depositAmount" placeholder="Amount">
            <button onclick="deposit(parseFloat(document.getElementById('depositAmount').value), document.getElementById('depositAccount').value)">Deposit</button>
        </section>
        
        <section>
            <p>Withdraw</p>
            <input type="text" id="withdrawAccount" placeholder="Account Number">
            <input type="text" id="withdrawAmount" placeholder="Amount">
            <button onclick="withdraw(parseFloat(document.getElementById('withdrawAmount').value), document.getElementById('withdrawAccount').value)">Withdraw</button>
        </section>

        <section>
            <p>Create New Account</p>
            <input type="text" id="accountNumber" placeholder="Account Number">
            <input type="text" id="balance" placeholder="Balance">
            <button onclick="createAccount()">Create Account</button>
        </section>
        
        <section>
            <input type="text" id="deleteAccount" placeholder="Account Number">
            <button onclick="deleteAccount()">Delete Account</button>
        </section>

        <section>
            <button onclick="localStorage.clear()">Reset All</button>
        </section>
    </center>

    <script type="text/javascript">

        function transact(amount, sourceNumber, targetNumber) {
            if (localStorage.getItem(sourceNumber) === null) {
                throw new Error('Source account does not exist');
            }
            if (localStorage.getItem(targetNumber) === null) {
                throw new Error('Target account does not exist');
            }
            
            if (parseFloat(localStorage.getItem(sourceNumber)) < amount) {
                throw new Error('Insufficient funds');
            }
        
            localStorage.setItem(sourceNumber, parseFloat(localStorage.getItem(sourceNumber)) - amount);
            localStorage.setItem(targetNumber, parseFloat(localStorage.getItem(targetNumber)) + amount);
            listAccounts();
        }

        function deposit(amount, accountNumber) {
            if (localStorage.getItem(accountNumber) === null) {
                throw new Error('Account does not exist');
            }
            localStorage.setItem(accountNumber, parseFloat(localStorage.getItem(accountNumber)) + amount);
            listAccounts();
        }

        function withdraw(amount, accountNumber) {
            if (localStorage.getItem(accountNumber) === null) {
                throw new Error('Account does not exist');
            }
            if (parseFloat(localStorage.getItem(accountNumber)) < amount) {
                throw new Error('Insufficient funds');
            }
            localStorage.setItem(accountNumber, parseFloat(localStorage.getItem(accountNumber)) - amount);
            listAccounts();
        }
        
        function setAccount(name, balance) {
            if (localStorage.getItem(name) != null) {
                throw new Error('Account already exists');
            }
            if (!balance) {
                balance = 0;
            }
            localStorage.setItem(name, balance);
            listAccounts();
        }
        
        function getAccount(name) {
            return parseFloat(localStorage.getItem(name));
        }

        function transferMoney() {
            const sourceNumber = document.getElementById('sourceNumber').value;
            const targetNumber = document.getElementById('targetNumber').value;
            const amount = parseFloat(document.getElementById('amount').value);
            
            try {
                transact(amount, sourceNumber, targetNumber);
                alert('Transaction successful');
                listAccounts();
            } catch (error) {
                alert(error.message);
            }
          }
        function createAccount() {
            const accountNumber = document.getElementById('accountNumber').value;
            const balance = parseFloat(document.getElementById('balance').value);

            try {
                setAccount(accountNumber, balance);
                alert('Account created successfully');
                listAccounts();
            } catch (error) {
                alert(error.message);
            }
        }
        function checkBalance() {
            const accountNumber = document.getElementById('checkBalance').value;
        
            try {
                const balance = getAccount(accountNumber);
                alert(`Account balance is ${balance}`);
            } catch (error) {
                alert(error.message);
            }
        }
        function deleteAccount() {
            const accountNumber = document.getElementById('deleteAccount').value;
        
            try {
                localStorage.removeItem(accountNumber);
                alert('Account deleted successfully');
                listAccounts();
            } catch (error) {
                alert(error.message);
            }
        }
        function listAccounts() {
            const accounts = [];
            for (let account in localStorage) {
                if (!localStorage.hasOwnProperty(account)) {
                    continue;
                }
                accounts.push({
                    name: account,
                    balance: parseFloat(localStorage.getItem(account))
                });
            }
            let comp = document.querySelector('transact-account-list');
            comp.accounts = accounts;
        }
    </script>
</body>
</html>